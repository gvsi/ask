<template name="postPage">
  <!-- START POSTS LIST -->
  {{>postList course_id=course_id}}
  <!-- END POSTS LIST -->
  <!-- START OPENED POST -->
  <div class="post-opened">
    {{>courseSettingsModal course_id=course_id}}
    <div class="no-post">
      {{#if posts.count}}
      <h2>Course stats go here</h2>
      {{else}}
      <h2>No posts here :(</h2>
      {{/if}}

      {{#if isUserInstructor=true}}
      <button class="btn btn-green btn-lg" data-target="#modalSlideLeft" data-toggle="modal">Course Settings</button>
      {{/if}}
    </div>

    {{>postContent}}

  </div>
  <!-- END OPENED POST -->
</template>

<template name="postContent">

  <div class="post-content-wrapper" style="display:none">
    <div class="actions-wrapper menuclipper bg-master-lightest">
      <ul class="actions menuclipper-menu no-margin p-l-20 ">
        <li class="visible-sm-inline-block visible-xs-inline-block">
          <a href="#" class="post-list-toggle"><i class="fa fa-angle-left"></i> All Inboxes
          </a>
        </li>

        <li class="no-padding "><a href="#" class="text-muted">Upvotes: {{post.upvoters.length}}</a>
        </li>
        <li class="no-padding "><a href="#" class="text-muted">Views: 0</a>
        </li>
        <li class="no-padding "><a href="#" class="text-info">Reply</a>
        </li>

        {{#if currentUserIsOwner}}
        <li class="no-padding ">
          <a href="{{pathFor 'editPost' course_id=post.course_id post_id=post._id}}" style="color:#447DF7">Edit</a>
        </li>
        <li class="no-padding "><a href="#" class="text-danger">Delete</a>
        </li>
        {{/if}}

        {{#each tags}}
        <li class="no-padding ">
          <button class="btn btn-tag  btn-tag-light m-r-5">{{this}}</button>
        </li>
        {{/each}}


      </ul>
      <div class="clearfix"></div>
    </div>
    <div class="post-content">
      <div class="q-footer">
        <div style="float:left">
          <div class="thumbnail-wrapper bordered circular" >
            <img width="40" height="40" alt="" src="{{identicon post.ownerIdenticon}}">
          </div>
          <div class="sender inline m-l-10">
            <p class="name no-margin bold">
              {{#if post.isAnonymous}}
              Anonymous
              {{else}}
              {{post.ownerName}} {{post.ownerSurname}}
              {{/if}}
            </p>
            <p class="datetime no-margin">
              {{dateFromNow}}
            </p>
          </div>

        </div>
        {{#unless currentUserIsOwner}}
        <div class="buttons">
          <button class="btn {{ upvoteButton }} btn-lg btn-rounded upvote" ><i class="fa fa-thumbs-up"></i></button>
          <button class="btn {{ followButton }} btn-lg btn-rounded" id="followQuestion" >Follow</button>
        </div>
        {{/unless}}
        <div class="clearfix"></div>
      </div>

      <div class="post-content-header">
        <h2><strong>{{post.title}}</strong></h2>
      </div>
      <div class="clearfix"></div>
      <div class="post-content-body m-t-20">
        {{#mathjax}}
        {{{post.text}}}
        {{/mathjax}}
      </div>

      {{>latexModal}}

      {{#each answers}}
      {{ >answer }}
      {{/each}}

      <hr>
      <div class="panel panel-transparent">
        <div class="panel-heading">
          <div class="panel-title">Write an answer:
          </div>
        </div>
        <div class="panel-body">
          <label class="error">{{errorMessage 'answerBody'}}</label>
          <div class="summernote-wrapper">
            <p><div id="summernote"></div></p>
          </div>
          <div class="checkbox inline m-l-20">
            <input type="checkbox" value="1" id="isAnswerAnonymous">
            <label for="isAnswerAnonymous" class="hint-text hidden-xs">Post as anonymous</label>
          </div>
          <button type="submit" id="sendAnswerBtn" class="btn btn-complete btn-cons m-l-10">Send</button>
        </div>
      </div>
    </div>
  </div>

</template>

<template name="answer">
  <hr>
  <div class="answer">
    <div class="postInfo">
      <div class="thumbnail-wrapper bordered circular" >
        <img width="40" height="40" alt="" src="{{identicon ownerIdenticon}}">
      </div>
      <div class="nameLabel bold">
        {{#if isAnonymous}}
        Anonymous
        {{else}}
        {{theAuthor.profile.name}}
        {{theAuthor.profile.surname}}
        {{/if}}
      </div>
      <div class="datetime timeLabel">
        {{#if currentUserIsOwner}}<button data-answer-id="{{_id}}" class="editAnswerBtn btn btn-default btn-xs">Edit answer</button>{{/if}}
        {{dateFromNow}}
      </div>
    </div>
    <div class="votingContainer" data-answer-id="{{this._id}}">
      <button class="btn btn-sm btn-rounded {{upvote}}" id="upvoteAnswer"><i class="fa fa-angle-up"></i></button>
      <div id="answerVoteCount">{{voteCount}}</div>
      <button class="btn btn-sm btn-rounded {{downvote}}"  id="downvoteAnswer"><i class="fa fa-angle-down"></i></button>
    </div>
    <div class="answerBodyContainer">
      <div id="body-{{_id}}">
        {{#mathjax}}
        {{{body}}}
        {{/mathjax}}
      </div>
      {{#if currentUserIsOwner}}
      <div class="summernote-wrapper" data-answer-id="{{_id}}" hidden>
        <label class="error"></label>
        <p><div id="summernote-edit-{{_id}}">
        {{{body}}}
        </div></p>
        <div class="checkbox inline m-l-20">
          <input type="checkbox" value="1" id="isAnswerAnonymous-edit-{{_id}}">
          <label for="isAnswerAnonymous-edit-{{_id}}" class="hint-text hidden-xs">Post as anonymous</label>
        </div>
        <button type="submit" data-answer-id="{{_id}}" class="updateAnswerBtn btn btn-complete btn-cons m-l-10">Update</button>
      </div>
      {{/if}}
    </div>
    <div class="comments">
      {{#each comments}}
      <hr>
      <div class="thumbnail-wrapper circular" data-toggle="tooltip" data-placement="left" data-html="true" title="{{#if isAnonymous}} Anonymous {{else}} {{theAuthor.profile.name}} <br> {{theAuthor.profile.surname}} {{/if}} <br> ({{dateFromNow}})">
        <img width="40" height="40" alt="" src="{{identicon this.ownerIdenticon}}">
      </div>
      <div class="commentBody">
        {{#mathjax}}
        {{{this.body}}}
        {{/mathjax}}
      </div>
      {{/each}}
      <button id="addCommentBtn" class="btn btn-default btn-xs m-t-10 pull-right">Add a comment</button>
      <div class="summernote-wrapper pull-right m-t-10" id="summernote-wrapper-{{_id}}" style="width:100%" hidden>
        <label class="error"></label>
        <p><div id="summernote-{{_id}}" class="summernote"></div></p>
        <div class="checkbox inline m-l-20">
          <input type="checkbox" value="1" id="isCommentAnon-{{_id}}">
          <label for="isCommentAnon-{{_id}}" class="hint-text hidden-xs">Post as anonymous</label>
        </div>
        <button type="submit" id="sendCommentBtn" data-answer-id="{{_id}}" class="btn btn-complete btn-sm m-l-10">Comment</button>
      </div>
    </div>

  </div>
</template>

<template name="latexModal">
  <!-- Modal -->
  <div class="modal fade slide-up disable-scroll" id="latexEditorModal" tabindex="-1" role="dialog" aria-labelledby="modalSlideUpLabel" aria-hidden="false">
    <div class="modal-dialog ">
      <div class="modal-content-wrapper">
        <div class="modal-content">
          <div class="modal-header clearfix text-left">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
              <i class="pg-close fs-14"></i>
            </button>
            <h5><span class="semi-bold">LaTeX</span> Equation Editor</h5>
          </div>
          <div class="modal-body">
            <textarea id="latex-source" style="width:80%;vertical-align:top;display:none;"></textarea>
            <span class="mathquill-editor"></span><br><br><br>
            <button type="submit" id="insertLatexBtn" class="btn btn-complete btn-cons pull-right">Insert</button>
          </div>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
  </div>
  <!-- /.modal-dialog -->
</template>

<template name="courseSettingsModal">
  {{#with course}}
  {{#if isUserInstructor=true}}
  <div class="modal fade slide-right" id="modalSlideLeft" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md" style="width: 420px">
      <div class="modal-content-wrapper">
        <div class="modal-content table-block" style="height:100%;overflow:auto;">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i></button>
          <div class="modal-body">
            <div class="p-l-10 p-r-10">
              <h2 class="semi-bold">
                Course Settings
              </h2>
              <!-- <p class=" hint-text no-margin">
              Color makes it different
            </p>-->
            <p class="small hint-text m-b-20">
              Control and customize this course.
            </p>
            <div class="m-t-20" style="width: 100%;">
              <span style="font-size: 19px;margin-top: 4px;" class="pull-left"> Lecture mode </span>
              <span class="pull-right"><input type="checkbox" class="switchery" /></span>
              <br>
              <p class="small hint-text m-t-10">
                When lecture mode is activated, students will be redirected to a special interface where they can ask question during lectures. Instructors will have their own interface to keep track of the questions that students have and manage them as they want during the lecture.
              </p>
            </div>
            <div class="m-t-20" style="width: 100%;">
              <span style="font-size: 19px;margin-top: 4px;" class="pull-left"> Use default tags </span>
              <span class="pull-right"><input type="checkbox" class="switchery" id="defaultTags" {{defaultTagsChecked}} /></span>
              <br>
              <p class="small hint-text m-t-10">
                Questions students ask on the platform can be tagged. Tags make searching, filtering and answering easier for students and instructor.
                (Leave custom tags field blank if you want to disable tags for this course)
              </p>
            </div>
            {{#if areTagsDefault}}
            <div class="form-group form-group-default m-t-20" id="defaultTagsForCourse">
              <label>Default tags</label>
              <div class="bootstrap-tagsinput">
                <span class="tag label label-info">wk1</span>
                <span class="tag label label-info">wk2</span>
                <span class="tag label label-info">wk3</span>
                <span class="tag label label-info">wk4</span>
                <span class="tag label label-info">wk5</span>
                <span class="tag label label-info">wk6</span>
                <span class="tag label label-info">wk7</span>
                <span class="tag label label-info">wk8</span>
                <span class="tag label label-info">wk9</span>
                <span class="tag label label-info">wk10</span>
                <span class="tag label label-info">wk11</span>
                <span class="tag label label-info">logistics</span>
                <span class="tag label label-info">exam</span>
                <span class="tag label label-info">other</span>
              </div>
            </div>
            {{else}}
              {{loadCustomTags}}
            {{/if}}

            <div class="form-group form-group-default m-t-20" id="customTagsForCourse" hidden>
              <label>Custom Tags</label>
              <input class="tagsinput custom-tag-input" type="text" />
            </div>

            <div class="m-t-20" style="width: 100%;">
              <span style="font-size: 19px;margin-top: 4px;" class="pull-left"> Instructors </span>
              <br>
              <p class="small hint-text m-t-10">
                Here you can add the teaching staff and course organisers for the course.
              </p>
            </div>

            <div class="form-group form-group-default m-t-20" >
              <label>Instructors</label>
              <input class="tagsinput" id="instructorsInput" type="text" />
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{{/if}}
{{/with}}
</template>
