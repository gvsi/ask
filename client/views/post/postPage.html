<template name="postPage">
  <!-- START POSTS LIST -->
  {{>postList courseId=courseId}}
  <!-- END POSTS LIST -->
  <!-- START OPENED POST -->
  <div class="post-opened">
    {{#if isUserInstructor}}
    {{>courseSettingsModal courseId=courseId}}
    {{/if}}
    <div class="no-post">
      {{#if isLoading}}
      <div style="margin-top:30%">{{>loading}}</div>
      {{else}}
        {{#if posts.count}}
        <h1><i class="fa fa-warning"></i></h1>
        <h2><strong>Under construction</strong></h2>
        <h3>Course stats go here</h3>
        <h4>Hold on tight – we are still building the course stats page</h4>
        {{else}}
        <h1><i class="fa fa-warning"></i></h1>
        <h2><strong>Under construction</strong></h2>
        <h3>No posts error page goes here</h3>
        <h4>Hold on tight – we are still building the page</h4>
        {{/if}}
        <br><br><br>
        {{#if isUserInstructor}}
        <button class="btn btn-green btn-lg" data-target="#courseSettingsModal" data-toggle="modal">Course Settings</button>
        {{/if}}
      {{/if}}
    </div>

    {{>postContent}}

  </div>
  <!-- END OPENED POST -->
</template>

<template name="postContent">

  <div class="modal fade slide-up disable-scroll" id="modalDeleteAnswer" tabindex="-1" role="dialog" aria-labelledby="modalSlideUpLabel" aria-hidden="false">
    <div class="modal-dialog " style="width:418px">
      <div class="modal-content-wrapper">
        <div class="modal-content">
          <div class="modal-header clearfix text-left">
            <h5>Are you sure you want to delete this answer?</h5>
          </div>
          <div class="modal-footer" style="margin-top: 16px;text-align: center;">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" id="deleteAnswer" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
  </div>

  <div class="post-content-wrapper" style="display:none">
    <div class="actions-wrapper menuclipper bg-master-lightest" id="postTopbar">
      <ul class="actions menuclipper-menu no-margin p-l-20" >
        <li>
          <a href="#" class="post-list-toggle"><i class="fa fa-angle-left"></i> All Questions
          </a>
        </li>
      </ul>
      <div class="clearfix"></div>
    </div>
    <div class="post-content">
      <div class="q-footer">
        <div style="float:left">
          <div class="thumbnail-wrapper bordered circular" >
            <img width="40" height="40" alt="" src="{{identicon post.userIdenticon}}">
          </div>
          <div class="sender inline m-l-10">
            <p class="name no-margin">
              {{#if post.isAnonymous}}
              <span class="bold">Anonymous</span>
              {{else}}
              {{#if post.isInstructorPost}}
              <span class="bold">{{post.ownerName}} {{post.ownerSurname}}</span><span class="small hint-text"> - instructor</span>
              {{else}}
              <span class="bold">
                {{post.ownerName}}
                {{post.ownerSurname}}
              </span>
              {{/if}}
              {{/if}}
            </p>
            <p class="datetime no-margin">
              {{dateFromNow}}
            </p>
          </div>

        </div>
        {{#if currentUserIsOwner}}
        <div class="buttons">
          <a href="{{pathFor 'editPost' courseId=post.courseId postId=post._id}}"> <button class="btn btn-lg btn-rounded edit"><i class="fa fa-pencil"></i></button> </a>
          <button class="btn btn-lg btn-rounded upvote delete" data-target="#modalDeletePost" data-toggle="modal" ><i class="fa fa-trash-o"></i></button>
          <button class="btn {{ upvoteButton }} btn-lg btn-rounded upvote" disabled><i class="fa fa-thumbs-up"></i><span class="m-l-10">{{post.upvoters.length}}</span></button>
        </div>

        <div class="modal fade slide-up disable-scroll" id="modalDeletePost" tabindex="-1" role="dialog" aria-labelledby="modalSlideUpLabel" aria-hidden="false">
          <div class="modal-dialog " style="width:394px">
            <div class="modal-content-wrapper">
              <div class="modal-content">
                <div class="modal-header clearfix text-left">
                  <h5>Are you sure you want to delete this post?</h5>
                </div>
                <div class="modal-footer" style="margin-top: 16px;text-align: center;">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  <button type="button" id="deletePost" class="btn btn-danger">Delete</button>
                </div>
              </div>
            </div>
            <!-- /.modal-content -->
          </div>
        </div>

        {{else}}
        <div class="buttons">
          <button class="btn {{ upvoteButton }} btn-lg btn-rounded upvote" ><i class="fa fa-thumbs-up"></i><span class="m-l-10">{{post.upvoters.length}}</span></button>
          <button class="btn {{ followButton }} btn-lg btn-rounded" id="followQuestion" >Follow</button>
        </div>
        {{/if}}
        <div class="clearfix"></div>
      </div>


      <div class="post-content-header">
        <h2><strong>{{post.title}}</strong></h2>
      </div>
      <div class="clearfix"></div>
      <div class="post-content-body m-t-10">
        {{#mathjax}}
        {{#autolink}}
        {{{post.text}}}
        {{/autolink}}
        {{/mathjax}}
      </div>

      <div class="q-footer" style="margin: 15px 0 -5px 0px;">
        {{#each tags}}
        <button class="btn btn-tag  btn-tag-light m-r-5">{{this}}</button>
        {{/each}}
      </div>

      {{>latexModal}}

      <div class="answers-wrapper">
      {{#each answers}}
      {{ >answer }}
      {{/each}}
      </div>

      <hr>
      <div class="panel panel-transparent">
        <div class="panel-heading">
          <div class="panel-title">Write an answer:
          </div>
        </div>
        <div class="panel-body">
          <label class="error">{{errorMessage 'answerBody'}}</label>
          <div class="tinymce-wrapper">
            <textarea id="answerTinyMCE" name="content"></textarea>
          </div>
          {{#unless isUserInstructor}}
          <div class="checkbox inline m-l-20">
            <input type="checkbox" value="1" id="isAnswerAnonymous">
            <label for="isAnswerAnonymous" class="hint-text">Post as anonymous</label>
          </div>
          {{/unless}}
          <button type="submit" id="sendAnswerBtn" class="btn btn-complete btn-cons m-l-10 m-t-10">Send answer</button>
        </div>
      </div>
    </div>
  </div>

</template>

<template name="answer">
  <hr>
  <div class="answer" id="{{_id}}">
    <div class="postInfo">
      <div class="thumbnail-wrapper bordered circular" >
        <img width="40" height="40" alt="" src="{{identicon userIdenticon}}">
      </div>
      <div class="nameLabel">
        {{#if isInstructor}}
        <span class="bold">{{theAuthor.profile.name}} {{theAuthor.profile.surname}}</span><span class="small hint-text"> - instructor</span>
        {{else}}
        <span class="bold">
          {{#if isAnonymous}}
          Anonymous
          {{else}}
          {{theAuthor.profile.name}}
          {{theAuthor.profile.surname}}
          {{/if}}
        </span>
        {{/if}}
      </div>
      <div class="datetime timeLabel">
        {{#if currentUserIsOwner}}
        <button class="editAnswerBtn btn btn-default btn-rounded btn-xs edit" data-answer-id="{{_id}}"><i class="fa fa-pencil"></i></button>
        <button class="btn btn-default btn-rounded btn-xs m-r-10 delete" id="openDeleteAnswerModal" data-id="{{_id}}" data-target="#modalDeleteAnswer" data-toggle="modal" ><i class="fa fa-trash-o"></i></button>
        {{/if}}
        {{dateFromNow}}
      </div>
    </div>
    <div class="votingContainer" data-answer-id="{{_id}}">
      <button class="btn btn-sm btn-rounded {{upvote}}" id="upvoteAnswer" {{disabledVoteForOwner}}><i class="fa fa-angle-up"></i></button>
      <div id="answerVoteCount">{{voteCount }}</div>
      <button class="btn btn-sm btn-rounded {{downvote}}"  id="downvoteAnswer" {{disabledVoteForOwner}}><i class="fa fa-angle-down"></i></button>
      {{#if isInstructorUpvoted}}
      <div class="check text-success"><i class="fa fa-check-circle" data-toggle="tooltip" data-placement="left" data-html="true" title="An instructor<br>upvoted<br>this answer"></i></div>
      {{/if}}
    </div>
    <div class="answerBodyContainer">
      <div class="answerBody" data-answer-id="{{_id}}">
        {{#mathjax}}
        {{#autolink}}
        {{{body}}}
        {{/autolink}}
        {{/mathjax}}
      </div>
      <div class="editAnswerTinyMCE-wrapper" data-answer-id="{{_id}}" hidden>
        <label class="error"></label>
        <textarea id="editAnswerTinyMCE-{{_id}}" name="content">{{{body}}}</textarea>
        <div class="m-t-20">
          {{#unless isUserInstructor}}
          <div class="checkbox inline m-l-20">
            <input type="checkbox" value="1" id="isAnswerAnonymous-edit-{{_id}}" {{isAnonymousChecked}}>
            <label for="isAnswerAnonymous-edit-{{_id}}" class="hint-text">Post as anonymous</label>
          </div>
          {{/unless}}
          <button type="submit" data-answer-id="{{_id}}" class="updateAnswerBtn btn btn-complete btn-cons m-l-10">Update</button>
          <button type="submit" data-answer-id="{{_id}}" class="cancelUpdateBtn btn btn-default btn-cons m-l-10">Cancel</button>
        </div>
      </div>
    </div>
    <div class="comments">
      {{#each comments}}
      <hr>
      <div class="thumbnail-wrapper circular" data-toggle="tooltip" data-placement="left" data-html="true" title="{{#if isAnonymous}} Anonymous {{else}} {{theAuthor.profile.name}} <br> {{theAuthor.profile.surname}} {{/if}} <br> ({{dateFromNow}})">
        <img width="40" height="40" alt="" src="{{identicon this.userIdenticon}}">
      </div>
      <div class="commentBody">
        {{#mathjax}}
        {{#autolink}}
        {{{this.body}}}
        {{createTooltip}}
        {{/autolink}}
        {{/mathjax}}
      </div>
      {{/each}}
      <button id="addCommentBtn" class="btn btn-default btn-xs m-t-10 pull-right">Add a comment</button>
      <div class="commentTinyMCE-wrapper pull-right m-t-10" data-answer-id="{{_id}}" style="width:100%" hidden>
        <label class="error"></label>
        <textarea id="commentTinyMCE-{{_id}}" name="content"></textarea>
        <div class="m-t-20">
          {{#unless isUserInstructor}}
          <div class="checkbox inline m-l-20">
            <input type="checkbox" value="1" id="isCommentAnon-{{_id}}">
            <label for="isCommentAnon-{{_id}}" class="hint-text">Post as anonymous</label>
          </div>
          {{/unless}}
          <button type="submit" id="sendCommentBtn" data-answer-id="{{_id}}" class="btn btn-complete btn-sm m-l-10">Comment</button>
        </div>
      </div>
    </div>

  </div>
</template>

<template name="latexModal">
  <!-- Modal -->
  <div class="modal fade slide-up disable-scroll" id="latexEditorModal" tabindex="-1" role="dialog" aria-labelledby="modalSlideUpLabel" aria-hidden="false">
    <div class="modal-dialog ">
      <div class="modal-content-wrapper">
        <div class="modal-content">
          <div class="modal-header clearfix text-left">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
              <i class="pg-close fs-14"></i>
            </button>
            <h5><span class="semi-bold">LaTeX</span> Equation Editor</h5>
          </div>
          <div class="modal-body">
            <textarea id="latex-source" style="width:80%;vertical-align:top;display:none;"></textarea>
            <span class="mathquill-editor"></span><br><br><br>
            <button type="submit" id="insertLatexBtn" class="btn btn-complete btn-cons pull-right">Insert</button>
          </div>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
  </div>
  <!-- /.modal-dialog -->
</template>

<template name="courseSettingsModal">
  {{#with course}}
  <div class="modal fade slide-right" id="courseSettingsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md" style="width: 420px">
      <div class="modal-content-wrapper">
        <div class="modal-content table-block" style="height:100%;overflow:auto;">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i></button>
          <div class="modal-body">
            <div class="p-l-10 p-r-10">
              <h2 class="semi-bold">
                Course Settings
              </h2>
              <!-- <p class=" hint-text no-margin">
              Color makes it different
            </p>-->
            <p class="small hint-text m-b-20">
              Control and customize this course.
            </p>
            <div class="m-t-20" style="width: 100%;">
              <span style="font-size: 19px;margin-top: 4px;" class="pull-left"> Lecture mode </span>
              <span class="pull-right"><input type="checkbox" class="switchery" id="lectureMode" /></span>
              <br>
              <p class="small hint-text m-t-10">
                When lecture mode is activated, students will be redirected to a special interface where they can ask question during lectures. Instructors will have their own interface to keep track of the questions that students have and manage them as they want during the lecture.
              </p>
            </div>
            <div class="m-t-20" style="width: 100%;">
              <span style="font-size: 19px;margin-top: 4px;" class="pull-left"> Use default tags </span>
              <span class="pull-right"><input type="checkbox" class="switchery" id="defaultTags" {{defaultTagsChecked}} /></span>
              <br>
              <p class="small hint-text m-t-10">
                Questions students ask on the platform can be tagged. Tags make searching, filtering and answering easier for students and instructor.
                (Leave custom tags field blank if you want to disable tags for this course)
              </p>
            </div>
            {{#if areTagsDefault}}
            <div class="form-group form-group-default m-t-20" id="defaultTagsForCourse">
              <label>Default tags</label>
              <div class="bootstrap-tagsinput">
                <span class="tag label label-info">wk1</span>
                <span class="tag label label-info">wk2</span>
                <span class="tag label label-info">wk3</span>
                <span class="tag label label-info">wk4</span>
                <span class="tag label label-info">wk5</span>
                <span class="tag label label-info">wk6</span>
                <span class="tag label label-info">wk7</span>
                <span class="tag label label-info">wk8</span>
                <span class="tag label label-info">wk9</span>
                <span class="tag label label-info">wk10</span>
                <span class="tag label label-info">wk11</span>
                <span class="tag label label-info">logistics</span>
                <span class="tag label label-info">exam</span>
                <span class="tag label label-info">other</span>
              </div>
            </div>
            {{else}}
            {{loadCustomTags}}
            {{/if}}

            <div class="form-group form-group-default m-t-20" id="customTagsForCourse" hidden>
              <label>Custom Tags</label>
              <input class="tagsinput custom-tag-input" type="text" />
            </div>

            <div class="m-t-20" style="width: 100%;">
              <span style="font-size: 19px;margin-top: 4px;" class="pull-left"> Instructors </span>
              <br>
              <p class="small hint-text m-t-10">
                Here you can add the teaching staff and course organisers for the course.
              </p>
            </div>

            <div class="form-group form-group-default m-t-20" >
              <label>Instructors</label>
              <input class="tagsinput" id="instructorsInput" type="text" />
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{{/with}}
</template>
